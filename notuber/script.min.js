!function(){let t,n,e,o={lat:42.352271,lng:-71.055242};function i(n,e,o,i){return new google.maps.Marker({position:{lat:n,lng:e},map:t,title:o,icon:i})}function a(n){let e=new google.maps.LatLngBounds;for(let o of n)e.extend(o.getPosition());t.fitBounds(e)}function s(){if(!e)return;a([n=i(e.coords.latitude,e.coords.longitude,"","")]);let o=new XMLHttpRequest;n.getPosition();let s=`username=jLttbNzY&lat=${n.position.lat()}&lng=${n.position.lng()}`;o.open("POST","https://intense-retreat-40766.herokuapp.com/rides"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=()=>{if(o.readyState===XMLHttpRequest.DONE&&200===o.status){var e;let s=o.responseText,r=[];try{r=JSON.parse(s)}catch(c){console.error(c.message)}let p=null;for(let u of r)(gMarker=i(u.lat,u.lng,u.username,"car.png")).distance=l({lat:n.position.lat(),lng:n.position.lng()},u),(null==p||gMarker.distance<p.distance)&&(p=gMarker);e=p,infoWindowHtml=`<p>Your Ride: ${e.title} <br/>Distance: ${e.distance} miles</p>`,n.infowindow=new google.maps.InfoWindow({content:infoWindowHtml}),google.maps.event.addListener(n,"click",function(){this.infowindow.open(t,this),function e(o){let i=new google.maps.Polyline({path:[{lat:n.position.lat(),lng:n.position.lng()},{lat:o.position.lat(),lng:o.position.lng()},],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});i.setMap(t)}(e),a([n,e])})}},o.send(s)}function l(t,n){var e,o,i,a;let s=t.lat*Math.PI/180,l=n.lat*Math.PI/180,r=(n.lat-t.lat)*Math.PI/180,c=(n.lng-t.lng)*Math.PI/180,p=Math.sin(r/2)*Math.sin(r/2)+Math.cos(s)*Math.cos(l)*Math.sin(c/2)*Math.sin(c/2);return 3958.756*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}navigator.geolocation.getCurrentPosition(function(n){e=n,t&&s()},function(t){console.error(t)},{enableHighAccuracy:!0,maximumAge:0}),window.initMap=function l(){t=new google.maps.Map(document.getElementById("map"),{center:o,zoom:15}),e&&(a([n=i(e.coords.latitude,e.coords.longitude,"","")]),s())}}();